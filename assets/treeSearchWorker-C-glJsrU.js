(function(){"use strict";let s;function h(r,e){return r=r>>>0,A().subarray(r/4,r/4+e)}function o(r,e){return r=r>>>0,W(r,e)}let f=null;function A(){return(f===null||f.byteLength===0)&&(f=new Uint32Array(s.memory.buffer)),f}let u=null;function y(){return(u===null||u.byteLength===0)&&(u=new Uint8Array(s.memory.buffer)),u}function g(r,e,t){if(t===void 0){const l=w.encode(r),d=e(l.length,1)>>>0;return y().subarray(d,d+l.length).set(l),c=l.length,d}let n=r.length,i=e(n,1)>>>0;const _=y();let a=0;for(;a<n;a++){const l=r.charCodeAt(a);if(l>127)break;_[i+a]=l}if(a!==n){a!==0&&(r=r.slice(a)),i=t(i,n,n=a+r.length*3,1)>>>0;const l=y().subarray(i+a,i+n),d=w.encodeInto(r,l);a+=d.written,i=t(i,n,a,1)>>>0}return c=a,i}function P(r){const e=s.__wbindgen_externrefs.get(r);return s.__externref_table_dealloc(r),e}let m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});m.decode();const E=2146435072;let S=0;function W(r,e){return S+=e,S>=E&&(m=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),m.decode(),S=e),m.decode(y().subarray(r,r+e))}const w=new TextEncoder;"encodeInto"in w||(w.encodeInto=function(r,e){const t=w.encode(r);return e.set(t),{read:r.length,written:t.length}});let c=0;const v=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>s.__wbg_gamestatehandle_free(r>>>0,1));class b{static __wrap(e){e=e>>>0;const t=Object.create(b.prototype);return t.__wbg_ptr=e,v.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,v.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_gamestatehandle_free(e,0)}hasWinner(){return s.gamestatehandle_hasWinner(this.__wbg_ptr)!==0}resetGame(){s.gamestatehandle_resetGame(this.__wbg_ptr)}findBestTurn(e){let t,n;try{const i=s.gamestatehandle_findBestTurn(this.__wbg_ptr,e);return t=i[0],n=i[1],o(i[0],i[1])}finally{s.__wbindgen_free(t,n,1)}}undoLastTurn(){return s.gamestatehandle_undoLastTurn(this.__wbg_ptr)!==0}applyTurnPlan(e){let t,n;try{const i=g(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=c,a=s.gamestatehandle_applyTurnPlan(this.__wbg_ptr,i,_);return t=a[0],n=a[1],o(a[0],a[1])}finally{s.__wbindgen_free(t,n,1)}}piecePositions(){const e=s.gamestatehandle_piecePositions(this.__wbg_ptr);var t=h(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),t}reachableRooms(e,t){const n=g(e,s.__wbindgen_malloc,s.__wbindgen_realloc),i=c,_=s.gamestatehandle_reachableRooms(this.__wbg_ptr,n,i,t);var a=h(_[0],_[1]).slice();return s.__wbindgen_free(_[0],_[1]*4,4),a}winnerPieceId(){let e,t;try{const n=s.gamestatehandle_winnerPieceId(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}animationFrames(){const e=s.gamestatehandle_animationFrames(this.__wbg_ptr);var t=h(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),t}boardRoomsJson(){let e,t;try{const n=s.gamestatehandle_boardRoomsJson(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}exportStateJson(){let e,t;try{const n=s.gamestatehandle_exportStateJson(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}importStateJson(e){let t,n;try{const i=g(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=c,a=s.gamestatehandle_importStateJson(this.__wbg_ptr,i,_);return t=a[0],n=a[1],o(a[0],a[1])}finally{s.__wbindgen_free(t,n,1)}}playerStatsJson(){let e,t;try{const n=s.gamestatehandle_playerStatsJson(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}previewTurnPlan(e){let t,n;try{const i=g(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=c,a=s.gamestatehandle_previewTurnPlan(this.__wbg_ptr,i,_);return t=a[0],n=a[1],o(a[0],a[1])}finally{s.__wbindgen_free(t,n,1)}}validateTurnPlan(e){let t,n;try{const i=g(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=c,a=s.gamestatehandle_validateTurnPlan(this.__wbg_ptr,i,_);return t=a[0],n=a[1],o(a[0],a[1])}finally{s.__wbindgen_free(t,n,1)}}normalTurnHistory(){let e,t;try{const n=s.gamestatehandle_normalTurnHistory(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}currentPlayerPieceId(){let e,t;try{const n=s.gamestatehandle_currentPlayerPieceId(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}currentNormalSetupJson(){let e,t;try{const n=s.gamestatehandle_currentNormalSetupJson(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}defaultNormalSetupJson(){let e,t;try{const n=s.gamestatehandle_defaultNormalSetupJson(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}prevTurnSummaryVerbose(){let e,t;try{const n=s.gamestatehandle_prevTurnSummaryVerbose(this.__wbg_ptr);return e=n[0],t=n[1],o(n[0],n[1])}finally{s.__wbindgen_free(e,t,1)}}startNewGameWithSetup(e,t,n){let i,_;try{const a=s.gamestatehandle_startNewGameWithSetup(this.__wbg_ptr,e,t,n);return i=a[0],_=a[1],o(a[0],a[1])}finally{s.__wbindgen_free(i,_,1)}}summary(e){let t,n;try{const i=s.gamestatehandle_summary(this.__wbg_ptr,e);return t=i[0],n=i[1],o(i[0],i[1])}finally{s.__wbindgen_free(t,n,1)}}}Symbol.dispose&&(b.prototype[Symbol.dispose]=b.prototype.free);function x(){const r=s.newDefaultGameState();if(r[2])throw P(r[1]);return b.__wrap(r[0])}const I=new Set(["basic","cors","default"]);async function J(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.ok&&I.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function M(){const r={};return r.wbg={},r.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(e,t){throw new Error(o(e,t))},r.wbg.__wbg_alert_460d621720343a04=function(e,t){alert(o(e,t))},r.wbg.__wbg_now_69d776cd24f5215b=function(){return Date.now()},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return o(e,t)},r.wbg.__wbindgen_init_externref_table=function(){const e=s.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r}function O(r,e){return s=r.exports,R.__wbindgen_wasm_module=e,f=null,u=null,s.__wbindgen_start(),s}async function R(r){if(s!==void 0)return s;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/KillDoctorLuckyWeb/assets/kill_doctor_lucky_rust_bg-CPWnvcGu.wasm",self.location.href));const e=M();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await J(await r,e);return O(t,n)}let T=null;const D=()=>(T||(T=R().then(()=>{})),T),p=self;p.onmessage=async r=>{const e=r.data;if(e.type==="analyze")try{await D();const t=x(),n=t.importStateJson(e.stateJson);if(n){const d={type:"analysisError",runId:e.runId,message:n};p.postMessage(d);return}const i=Math.max(0,Math.trunc(e.analysisLevel)),_=t.findBestTurn(i);let a="";try{const d=JSON.parse(_);d.isValid&&Array.isArray(d.suggestedTurn)&&(a=t.previewTurnPlan(JSON.stringify(d.suggestedTurn)))}catch{a=""}const l={type:"analysisResult",runId:e.runId,analysisRaw:_,previewRaw:a};p.postMessage(l)}catch(t){const n=t instanceof Error?t.message:"Tree search worker failed.",i={type:"analysisError",runId:e.runId,message:n};p.postMessage(i)}}})();
//# sourceMappingURL=treeSearchWorker-C-glJsrU.js.map
